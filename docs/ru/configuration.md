# Конфигурация

MTChat настраивается через переменные окружения. Все настройки имеют разумные значения по умолчанию -- только `DATABASE_URL` и `ADMIN_API_TOKEN` обязательны.

## Обязательные

| Переменная | Описание | Пример |
|------------|----------|--------|
| `DATABASE_URL` | Строка подключения PostgreSQL | `postgres://user:pass@localhost:5432/mtchat` |
| `ADMIN_API_TOKEN` | Токен для аутентификации Management API | `your-secure-admin-token` |

## Сервер

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `PORT` | `8080` | Порт HTTP-сервера |
| `RUST_LOG` | `info` | Уровень логирования |

## Redis (опционально)

Включает онлайн-присутствие, очередь задач и умные уведомления.

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `REDIS_URL` | -- | URL подключения к Redis |

## S3 / MinIO (опционально)

Включает загрузку и скачивание файловых вложений.

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `S3_ENDPOINT` | -- | URL S3/MinIO сервера |
| `S3_PUBLIC_ENDPOINT` | -- | Публичный URL S3 для presigned-ссылок скачивания |
| `S3_BUCKET` | -- | Имя бакета S3 |
| `S3_ACCESS_KEY_ID` | -- | Ключ доступа S3 |
| `S3_SECRET_ACCESS_KEY` | -- | Секретный ключ S3 |
| `S3_REGION` | `us-east-1` | Регион S3 |

!!! tip
    `S3_PUBLIC_ENDPOINT` -- URL, по которому браузеры обращаются к S3. В локальной разработке с MinIO это обычно `http://localhost:9000`, а `S3_ENDPOINT` -- внутренний URL Docker-сети `http://minio:9000`.

## Вебхуки (опционально)

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `WEBHOOK_URL` | -- | URL вашего вебхук-эндпоинта |
| `WEBHOOK_SECRET` | -- | Секрет для HMAC-SHA256 подписи |

## Фоновые задачи

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `NOTIFICATION_DELAY_SECS` | `30` | Задержка перед отправкой уведомления (сек) |
| `NOTIFICATION_CONCURRENCY` | `10` | Количество параллельных воркеров |
| `ARCHIVE_CRON` | `0 */5 * * * *` | Расписание проверки авто-архивации |
| `ARCHIVE_AFTER_SECS` | `259200` | Секунды неактивности до авто-архивации (3 дня) |

## Мониторинг

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| `SENTRY_DSN` | -- | DSN для Sentry error tracking |

## Health Checks

| Эндпоинт | Описание |
|----------|----------|
| `GET /health` | Проверка работоспособности |
| `GET /health/ready` | Проверка готовности (верифицирует подключение к БД) |

## Graceful Degradation

MTChat работает с минимальной инфраструктурой. Только PostgreSQL обязателен:

| Функция | Требует |
|---------|---------|
| Базовый обмен сообщениями | PostgreSQL |
| Онлайн-статус | PostgreSQL + Redis |
| Файловые вложения | PostgreSQL + S3 |
| Умные уведомления | PostgreSQL + Redis + Webhook URL |
| Авто-архивация | PostgreSQL + Redis |
